<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Blue Lock 2D - WASD, Campo Ampliado & Tela Cheia</title>
  <style>
    body {
      margin: 0;
      background: #113377;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
      color: #fff;
      font-family: Arial, sans-serif;
    }
    h1 {
      margin-top: 24px;
    }
    #container {
      margin-top: 24px;
      background: #222;
      border-radius: 10px;
      box-shadow: 0 8px 32px #0006;
      padding: 1rem 2rem 2rem 2rem;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    canvas {
      background: #60b347;
      border: 4px solid #222;
      border-radius: 10px;
      margin-bottom: 1rem;
      display: block;
      transition: box-shadow 0.2s;
    }
    #scoreboard {
      font-size: 1.1rem;
      margin-bottom: 1rem;
    }
    #instructions {
      font-size: 1rem;
      margin-bottom: 0.5rem;
      color: #eee;
    }
    .skills {
      margin-bottom: 1rem;
      display: flex;
      gap: 1rem;
    }
    .skills button, #dribbleBtn {
      padding: 0.5rem 1.5rem;
      font-size: 1rem;
      border: none;
      border-radius: 7px;
      background: #00bfff;
      color: #153e6b;
      cursor: pointer;
      font-weight: bold;
      transition: background .2s, color .2s;
    }
    .skills button.active {
      background: #ffe600;
      color: #222;
    }
    .skills button:active, #dribbleBtn:active {
      background: #1e90ff;
      color: #fff;
    }
    #restart {
      display: none;
      padding: 0.5rem 1.5rem;
      font-size: 1.1rem;
      border: none;
      border-radius: 7px;
      background: #00bfff;
      color: #153e6b;
      cursor: pointer;
      margin-top: 1rem;
      transition: background .2s;
    }
    #restart:hover {
      background: #1e90ff;
    }
    #dribbleBtn {
      display: none;
      margin-bottom: 1rem;
      background: #ffe600;
      color: #191970;
      font-weight: bold;
      border: 2px solid #153e6b;
      box-shadow: 0 0 8px #fff70080;
      animation: dribblePulse 1s infinite alternate;
    }
    @keyframes dribblePulse {
      0% { box-shadow: 0 0 8px #ffe60080; }
      100% { box-shadow: 0 0 18px #ffe600cc; }
    }
    .keyhint {
      font-size: 0.9em;
      color: #ffe600;
      background: #242424;
      border-radius: 5px;
      padding: 2px 7px;
      margin-left: 0.3em;
      margin-right: 0.3em;
      font-weight: bold;
      letter-spacing: 1px;
      border: 1.5px solid #ffe60090;
      vertical-align: middle;
    }
    #fullscreenBtn {
      margin-bottom: 1rem;
      background: #ffe600;
      color: #191970;
      border: 2px solid #153e6b;
      font-weight: bold;
      border-radius: 7px;
      padding: 0.5rem 1.5rem;
      cursor: pointer;
      font-size: 1rem;
      transition: background .2s, color .2s;
    }
    #fullscreenBtn:hover {
      background: #fff38d;
    }
  </style>
</head>
<body>
  <h1>Blue Lock 2D - WASD, Campo Ampliado & Tela Cheia</h1>
  <div id="container">
    <div id="scoreboard"></div>
    <div id="instructions">
      Mova-se com <span class="keyhint">WASD</span>. <span class="keyhint">Espaço</span> para chutar!<br>
      Skills: <span class="keyhint">Z</span> Kaiser Impact | <span class="keyhint">X</span> Chute Curvo | <span class="keyhint">Q</span> Drible<br>
      Ative skills antes de chutar, drible apenas quando aparecer o botão!
    </div>
    <button id="fullscreenBtn">Tela Cheia</button>
    <div class="skills">
      <button id="kaiserBtn">Kaiser Impact ⚡ <span class="keyhint">Z</span></button>
      <button id="curvoBtn">Chute Curvo 🌀 <span class="keyhint">X</span></button>
    </div>
    <button id="dribbleBtn">Driblar! <span class="keyhint">Q</span></button>
    <canvas id="game" width="900" height="540"></canvas>
    <button id="restart">Jogar Novamente</button>
  </div>
  <script>
    // CAMPO AMPLIADO
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');
    const scoreboard = document.getElementById('scoreboard');
    const restartBtn = document.getElementById('restart');
    const kaiserBtn = document.getElementById('kaiserBtn');
    const curvoBtn = document.getElementById('curvoBtn');
    const dribbleBtn = document.getElementById('dribbleBtn');
    const fullscreenBtn = document.getElementById('fullscreenBtn');

    // Campo maior!
    const field = {
      width: 900,
      height: 540,
      goal: {x: 400, y: 18, w: 100, h: 24}
    };

    // Estado do jogo
    let player, ball, goalie, defenders;
    let score = 0;
    let chances = 3;
    let gameState = 'playing'; // 'playing', 'goal', 'miss', 'over', 'dribble'
    let dribbleWindow = false;
    let dribbleSuccess = false;
    let dribbleFailTimeout = null;
    let ankleBreakerDuration = 1800; // ms

    // Skills
    let kaiserActive = false;
    let curvoActive = false;

    function resetPositions() {
      player = {x: field.width/2, y: field.height-80, r: 20, speed: 4};
      ball = {
        x: player.x,
        y: player.y - 24,
        r: 11,
        speed: 7,
        vx: 0, vy: 0,
        moving: false,
        curveT: 0,
        curveMaxT: 80,
        curveDir: 0,
        curving: false
      };
      goalie = {
        x: field.width/2 + Math.random() * 60 - 30,
        y: 48,
        r: 24,
        speed: 3.5,
        dir: 1,
        reaction: 0.18 + Math.random()*0.10
      };
      defenders = [
        {
          x: field.goal.x + 40,
          y: 190,
          r: 20,
          speed: 3 + Math.random()*0.8,
          state: "normal",
          ankleBreakerEnd: 0
        },
        {
          x: field.goal.x + field.goal.w - 40,
          y: 320,
          r: 20,
          speed: 3 + Math.random()*0.8,
          state: "normal",
          ankleBreakerEnd: 0
        }
      ];
      dribbleWindow = false;
      dribbleSuccess = false;
      clearTimeout(dribbleFailTimeout);
      dribbleBtn.style.display = "none";
    }

    function drawField() {
      ctx.fillStyle = '#60b347';
      ctx.fillRect(0, 0, field.width, field.height);
      ctx.fillStyle = '#fff';
      ctx.fillRect(field.goal.x, field.goal.y, field.goal.w, field.goal.h);
      ctx.strokeStyle = '#fff';
      ctx.strokeRect(field.goal.x, field.goal.y, field.goal.w, 48);
      ctx.strokeRect(field.goal.x - 80, field.goal.y + 24, field.goal.w + 160, 110);
      ctx.strokeStyle = '#fff8';
      ctx.beginPath();
      ctx.moveTo(0, field.height / 2);
      ctx.lineTo(field.width, field.height / 2);
      ctx.stroke();
    }

    function drawPlayer() {
      ctx.beginPath();
      ctx.arc(player.x, player.y, player.r, 0, 2 * Math.PI);
      ctx.fillStyle = '#2196f3';
      ctx.fill();
      ctx.strokeStyle = '#fff';
      ctx.lineWidth = 3;
      ctx.stroke();
      ctx.beginPath();
      ctx.arc(player.x, player.y - 12, 8, 0, 2 * Math.PI);
      ctx.fillStyle = '#42a5f5';
      ctx.fill();
      ctx.lineWidth = 1;
    }

    function drawBall() {
      ctx.beginPath();
      ctx.arc(ball.x, ball.y, ball.r, 0, 2 * Math.PI);
      ctx.fillStyle = '#fff';
      ctx.fill();
      ctx.strokeStyle = '#222';
      ctx.stroke();
      ctx.beginPath();
      ctx.arc(ball.x + 3, ball.y + 3, 3.5, 0, 2 * Math.PI);
      ctx.fillStyle = '#ccc';
      ctx.fill();
      if (kaiserActive && ball.moving) {
        ctx.save();
        ctx.globalAlpha = 0.5;
        ctx.beginPath();
        ctx.arc(ball.x, ball.y, ball.r+11, 0, 2*Math.PI);
        ctx.strokeStyle = '#ffe600';
        ctx.lineWidth = 4;
        ctx.stroke();
        ctx.restore();
      }
      if (curvoActive && ball.moving) {
        ctx.save();
        ctx.globalAlpha = 0.45;
        ctx.beginPath();
        ctx.arc(ball.x, ball.y, ball.r+15, 0, 2*Math.PI);
        ctx.strokeStyle = '#00eaff';
        ctx.lineWidth = 4;
        ctx.stroke();
        ctx.restore();
      }
    }

    function drawGoalie() {
      ctx.beginPath();
      ctx.arc(goalie.x, goalie.y, goalie.r, 0, 2 * Math.PI);
      ctx.fillStyle = '#d32f2f';
      ctx.fill();
      ctx.strokeStyle = '#fff';
      ctx.lineWidth = 3;
      ctx.stroke();
      ctx.beginPath();
      ctx.arc(goalie.x, goalie.y - 12, 8, 0, 2 * Math.PI);
      ctx.fillStyle = '#ef5350';
      ctx.fill();
      ctx.lineWidth = 1;
    }

    function drawDefenders() {
      defenders.forEach(def => {
        if (def.state === "anklebreaker") {
          ctx.save();
          ctx.globalAlpha = 0.4;
          ctx.beginPath();
          ctx.arc(def.x, def.y, def.r, 0, 2 * Math.PI);
          ctx.fillStyle = '#bbb';
          ctx.fill();
          ctx.strokeStyle = '#999';
          ctx.lineWidth = 3;
          ctx.stroke();
          ctx.beginPath();
          ctx.arc(def.x, def.y - 10, 7, 0, 2 * Math.PI);
          ctx.fillStyle = '#888';
          ctx.fill();
          ctx.strokeStyle = "#999";
          ctx.lineWidth = 4;
          ctx.beginPath();
          ctx.moveTo(def.x-def.r/1.2, def.y-def.r/1.2);
          ctx.lineTo(def.x+def.r/1.2, def.y+def.r/1.2);
          ctx.moveTo(def.x+def.r/1.2, def.y-def.r/1.2);
          ctx.lineTo(def.x-def.r/1.2, def.y+def.r/1.2);
          ctx.stroke();
          ctx.restore();
        } else {
          ctx.beginPath();
          ctx.arc(def.x, def.y, def.r, 0, 2 * Math.PI);
          ctx.fillStyle = '#f7b731';
          ctx.fill();
          ctx.strokeStyle = '#fff';
          ctx.lineWidth = 3;
          ctx.stroke();
          ctx.beginPath();
          ctx.arc(def.x, def.y - 10, 7, 0, 2 * Math.PI);
          ctx.fillStyle = '#e67e22';
          ctx.fill();
          ctx.lineWidth = 1;
        }
      });
    }

    function updateGoalie() {
      if (ball.moving) {
        let t = (field.goal.y + field.goal.h - ball.y) / ball.vy;
        let interceptX = ball.x + ball.vx * t;
        if (t < 0 || isNaN(t) || !isFinite(t)) {
        } else {
          let diff = interceptX - goalie.x;
          goalie.x += diff * goalie.reaction;
          if (goalie.x - goalie.r < field.goal.x) goalie.x = field.goal.x + goalie.r;
          if (goalie.x + goalie.r > field.goal.x + field.goal.w) goalie.x = field.goal.x + field.goal.w - goalie.r;
        }
      } else {
        let diff = player.x - goalie.x;
        goalie.x += diff * 0.07;
        if (goalie.x - goalie.r < field.goal.x) goalie.x = field.goal.x + goalie.r;
        if (goalie.x + goalie.r > field.goal.x + field.goal.w) goalie.x = field.goal.x + field.goal.w - goalie.r;
      }
    }

    function updateDefenders() {
      let now = Date.now();
      defenders.forEach(def => {
        if (def.state === "anklebreaker" && now >= def.ankleBreakerEnd) {
          def.state = "normal";
        }
        if (def.state === "normal" && !ball.moving && !dribbleWindow) {
          let dx = player.x - def.x;
          let dy = player.y - def.y;
          let dist = Math.sqrt(dx*dx + dy*dy);
          if (dist > 1) {
            let normX = dx / dist;
            let normY = dy / dist;
            let rand = (Math.random()-0.5)*0.3;
            def.x += (normX + rand) * def.speed;
            def.y += (normY + rand) * def.speed;
          }
          if (def.y < 110) def.y = 110;
          if (def.y > field.height-120) def.y = field.height-120;
          if (def.x - def.r < 10) def.x = 10 + def.r;
          if (def.x + def.r > field.width-10) def.x = field.width-10 - def.r;
        }
      });
    }

    // WASD e atalhos
    let keys = {};
    document.addEventListener('keydown', e => {
      if (e.repeat) return;
      if (e.key === 'z' || e.key === 'Z') {
        e.preventDefault();
        if (!ball.moving && gameState === "playing" && !dribbleWindow) {
          kaiserActive = !kaiserActive;
          kaiserBtn.classList.toggle('active', kaiserActive);
        }
      } else if (e.key === 'x' || e.key === 'X') {
        e.preventDefault();
        if (!ball.moving && gameState === "playing" && !dribbleWindow) {
          curvoActive = !curvoActive;
          curvoBtn.classList.toggle('active', curvoActive);
        }
      } else if ((e.key === 'q' || e.key === 'Q') && dribbleWindow && !dribbleSuccess) {
        e.preventDefault();
        triggerDribble();
      }
      else if (gameState === 'playing' && !dribbleWindow) {
        if (['w','a','s','d',' '].includes(e.key.toLowerCase())) {
          keys[e.key.toLowerCase()] = true;
          if ((e.key === ' ' || e.key === 'Spacebar') && !ball.moving) {
            kickBall();
          }
        }
      }
    });
    document.addEventListener('keyup', e => {
      if (['w','a','s','d',' '].includes(e.key.toLowerCase())) {
        keys[e.key.toLowerCase()] = false;
      }
    });

    function updatePlayer() {
      if (ball.moving || dribbleWindow) return;
      if (keys['a'] && player.x - player.r > 0) player.x -= player.speed;
      if (keys['d'] && player.x + player.r < field.width) player.x += player.speed;
      if (keys['w'] && player.y - player.r > 100) player.y -= player.speed;
      if (keys['s'] && player.y + player.r < field.height) player.y += player.speed;
      ball.x = player.x;
      ball.y = player.y - player.r - ball.r - 3;
    }

    function kickBall() {
      let speedMult = 1;
      if (kaiserActive) speedMult = 2.3;
      let isCurvo = curvoActive;
      const targetX = field.goal.x + field.goal.w/2 + (Math.random()-0.5)*150;
      const targetY = field.goal.y + field.goal.h + 8;
      const dx = targetX - ball.x;
      const dy = targetY - ball.y;
      const dist = Math.sqrt(dx*dx + dy*dy);
      ball.vx = ball.speed * speedMult * dx / dist;
      ball.vy = ball.speed * speedMult * dy / dist;
      ball.moving = true;
      if (isCurvo) {
        ball.curving = true;
        ball.curveT = 0;
        ball.curveDir = Math.random() > 0.5 ? 1 : -1;
      } else {
        ball.curving = false;
      }
      kaiserActive = false;
      curvoActive = false;
      kaiserBtn.classList.remove('active');
      curvoBtn.classList.remove('active');
    }

    function updateBall() {
      if (!ball.moving) return;
      if (ball.curving && ball.curveT < ball.curveMaxT) {
        const curveStrength = 2.1 * ball.curveDir * Math.sin(Math.PI * ball.curveT / ball.curveMaxT);
        ball.vx += curveStrength * 0.05;
        ball.curveT++;
      }
      ball.x += ball.vx;
      ball.y += ball.vy;
      const distGoalie = Math.hypot(ball.x - goalie.x, ball.y - goalie.y);
      if (distGoalie < ball.r + goalie.r) {
        gameState = 'miss';
        chances--;
        showResult('Defendido pelo goleiro! 😱');
        return;
      }
      if (
        ball.y - ball.r <= field.goal.y + field.goal.h &&
        ball.x >= field.goal.x &&
        ball.x <= field.goal.x + field.goal.w
      ) {
        gameState = 'goal';
        score++;
        showResult('GOOOOL! ⚽️');
        return;
      }
      if (ball.y < 0 || ball.x < 0 || ball.x > field.width) {
        gameState = 'miss';
        chances--;
        showResult('Você errou o gol! 😓');
        return;
      }
    }

    function checkDefenderCollision() {
      if (ball.moving || dribbleWindow) return;
      for (let i=0; i<defenders.length; i++) {
        let def = defenders[i];
        if (def.state === "anklebreaker") continue;
        const dist = Math.hypot(player.x - def.x, player.y - def.y);
        if (dist < player.r + def.r + 10) {
          dribbleWindow = true;
          dribbleSuccess = false;
          dribbleBtn.style.display = "inline-block";
          dribbleBtn.dataset.defender = i;
          gameState = "dribble";
          dribbleFailTimeout = setTimeout(() => {
            if (!dribbleSuccess) {
              dribbleBtn.style.display = "none";
              gameState = "miss";
              chances--;
              showResult('O zagueiro roubou a bola! 😵');
            }
          }, 1100);
          break;
        }
      }
    }

    function ankleBreaker(defenderIndex) {
      let def = defenders[defenderIndex];
      def.state = "anklebreaker";
      def.ankleBreakerEnd = Date.now() + ankleBreakerDuration;
    }

    function triggerDribble() {
      if (dribbleWindow && !dribbleSuccess) {
        dribbleSuccess = true;
        dribbleWindow = false;
        gameState = "playing";
        dribbleBtn.style.display = "none";
        clearTimeout(dribbleFailTimeout);
        player.y -= 36;
        if (player.y < 100 + player.r) player.y = 100 + player.r + 2;
        if (dribbleBtn.dataset.defender !== undefined) {
          ankleBreaker(Number(dribbleBtn.dataset.defender));
          dribbleBtn.dataset.defender = "";
        }
      }
    }

    dribbleBtn.onclick = triggerDribble;

    function showResult(msg) {
      setTimeout(() => {
        if (chances === 0) {
          gameState = 'over';
          draw();
          scoreboard.innerHTML = `<b>Fim de jogo!</b> Gols: ${score}<br>` +
            (score >= 3
              ? "Você é digno do Blue Lock! 🏆"
              : "Continue treinando para ser o melhor!");
          restartBtn.style.display = 'block';
        } else {
          scoreboard.innerHTML = msg + `<br>Gols: ${score} | Chances restantes: ${chances}`;
          resetPositions();
          setTimeout(() => {
            scoreboard.innerHTML = `Gols: ${score} | Chances restantes: ${chances}`;
            gameState = 'playing';
          }, 1200);
        }
      }, 700);
    }

    function draw() {
      drawField();
      drawDefenders();
      drawGoalie();
      drawPlayer();
      drawBall();
    }

    function gameLoop() {
      if (gameState === 'playing') {
        updatePlayer();
        updateGoalie();
        updateDefenders();
        updateBall();
        checkDefenderCollision();
        scoreboard.innerHTML = `Gols: ${score} | Chances restantes: ${chances}`;
      }
      if (gameState === 'dribble') {
        updateGoalie();
        updateDefenders();
        draw();
        scoreboard.innerHTML = `Drible! Pressione <span class="keyhint">Q</span> ou clique no botão para driblar o zagueiro!<br>Gols: ${score} | Chances restantes: ${chances}`;
      } else {
        draw();
      }
      if (gameState !== 'over') {
        requestAnimationFrame(gameLoop);
      }
    }

    restartBtn.onclick = () => {
      score = 0;
      chances = 3;
      gameState = 'playing';
      restartBtn.style.display = 'none';
      resetPositions();
      gameLoop();
    };

    kaiserBtn.onclick = () => {
      if (!ball.moving && gameState === "playing" && !dribbleWindow) {
        kaiserActive = !kaiserActive;
        kaiserBtn.classList.toggle('active', kaiserActive);
      }
    };
    curvoBtn.onclick = () => {
      if (!ball.moving && gameState === "playing" && !dribbleWindow) {
        curvoActive = !curvoActive;
        curvoBtn.classList.toggle('active', curvoActive);
      }
    };

    // Tela cheia
    fullscreenBtn.onclick = () => {
      if (canvas.requestFullscreen) {
        canvas.requestFullscreen();
      } else if (canvas.webkitRequestFullscreen) {
        canvas.webkitRequestFullscreen();
      } else if (canvas.msRequestFullscreen) {
        canvas.msRequestFullscreen();
      }
    };
    // Ajusta canvas para tela cheia (responsivo)
    document.addEventListener('fullscreenchange', () => {
      if (document.fullscreenElement === canvas) {
        canvas.style.width = "100vw";
        canvas.style.height = "100vh";
        setTimeout(() => {
          canvas.width = window.innerWidth;
          canvas.height = window.innerHeight;
        }, 100);
      } else {
        canvas.style.width = "";
        canvas.style.height = "";
        canvas.width = field.width;
        canvas.height = field.height;
      }
    });

    // Inicializa
    resetPositions();
    gameLoop();
  </script>
</body>
</html>
